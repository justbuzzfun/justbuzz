<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWIN-ENGINE RADAR (1H + 15m)</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: 'Chakra Petch', sans-serif; margin: 0; padding: 20px; }
        
        .header { border-bottom: 2px solid #00bcd4; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: #000; z-index: 100; }
        .logo { font-size: 20px; font-weight: bold; color: #00bcd4; letter-spacing: 1px; }
        .status { font-size: 10px; color: #888; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(290px, 1fr)); gap: 12px; }

        .card { background: #0b0b0b; border: 1px solid #222; padding: 12px; border-radius: 6px; position: relative; transition: 0.3s; opacity: 0.5; filter: grayscale(1); }
        
        /* ACTIVE CARDS */
        .card.active { opacity: 1; filter: grayscale(0); border: 2px solid #fff; order: -1; transform: scale(1.02); z-index: 10;}
        .card.long { border-color: #00ff41; box-shadow: 0 0 25px rgba(0, 255, 65, 0.25); }
        .card.short { border-color: #ff0055; box-shadow: 0 0 25px rgba(255, 0, 85, 0.25); }

        .card-header { display: flex; justify-content: space-between; font-size: 16px; font-weight: bold; margin-bottom: 8px; }
        
        /* TREND BADGES */
        .trend-row { display: flex; gap: 5px; margin-bottom: 8px; font-size: 10px; font-weight: bold; }
        .badge { padding: 3px 6px; border-radius: 3px; background: #222; color: #555; border: 1px solid #333; }
        .badge.up { background: rgba(0, 255, 65, 0.1); color: #00ff41; border-color: #00ff41; }
        .badge.down { background: rgba(255, 0, 85, 0.1); color: #ff0055; border-color: #ff0055; }

        .data-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; color: #888; }
        .val { color: #fff; font-weight: bold; }
        
        .signal-box { margin-top: 8px; text-align: center; font-weight: bold; padding: 6px; border-radius: 4px; font-size: 13px; background: #111; color: #555; }
        
        .card.long .signal-box { background: #00ff41; color: #000; animation: pulse 1s infinite; }
        .card.short .signal-box { background: #ff0055; color: #fff; animation: pulse 1s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        #loading { text-align: center; margin-top: 50px; color: #00bcd4; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <div class="logo">ğŸš€ TWIN-ENGINE RADAR</div>
            <div class="status">FILTERS: 1H & 15M ALIGNMENT | SIGNAL: 5M</div>
        </div>
        <button onclick="toggleSound()" style="background:#222; color:#fff; border:1px solid #00bcd4; padding:5px 10px; cursor:pointer;">ğŸ”Š ON</button>
    </div>

    <div id="loading">SYNCING TIMEFRAMES...</div>
    <div id="grid" class="grid"></div>

    <audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        const grid = document.getElementById('grid');
        const loading = document.getElementById('loading');
        let soundEnabled = true;
        let pairs = [];

        async function init() {
            try {
                const res = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
                const data = await res.json();
                
                pairs = data
                    .filter(p => p.symbol.endsWith('USDT') && parseFloat(p.quoteVolume) > 15000000)
                    .sort((a, b) => parseFloat(b.quoteVolume) - parseFloat(a.quoteVolume))
                    .slice(0, 80);

                const specialCoins = ['PNUTUSDT', 'ACTUSDT', 'FILUSDT', '1000PEPEUSDT'];
                specialCoins.forEach(coin => {
                    if (!pairs.find(p => p.symbol === coin)) pairs.push({ symbol: coin });
                });

                loading.style.display = 'none';
                startScanning();
            } catch (e) {
                loading.innerText = "VPN REQUIRED";
            }
        }

        async function startScanning() {
            for (let i = 0; i < pairs.length; i++) {
                await analyzePair(pairs[i].symbol);
                await new Promise(r => setTimeout(r, 150));
            }
            setTimeout(startScanning, 3000);
        }

        async function analyzePair(symbol) {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Û³ ØªØ§ ØªØ§ÛŒÙ… ÙØ±ÛŒÙ… Ù‡Ù…Ø²Ù…Ø§Ù†: 1H, 15m, 5m
                const [kline1hRes, kline15mRes, kline5mRes, fundingRes] = await Promise.all([
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=1h&limit=2`),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=15m&limit=2`),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=5m&limit=50`),
                    fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${symbol}`)
                ]);

                const kline1h = await kline1hRes.json();
                const kline15m = await kline15mRes.json();
                const kline5m = await kline5mRes.json();
                const funding = await fundingRes.json();

                // --- Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±ÙˆÙ†Ø¯ 1 Ø³Ø§Ø¹ØªÙ‡ ---
                const currentPrice = parseFloat(kline1h[1][4]);
                const open1h = parseFloat(kline1h[1][1]);
                const change1h = ((currentPrice - open1h) / open1h) * 100;
                
                // --- Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±ÙˆÙ†Ø¯ 15 Ø¯Ù‚ÛŒÙ‚Ù‡ ---
                const open15m = parseFloat(kline15m[1][1]);
                const change15m = ((currentPrice - open15m) / open15m) * 100;

                // --- Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³ÛŒÚ¯Ù†Ø§Ù„ 5 Ø¯Ù‚ÛŒÙ‚Ù‡ ---
                const closes = kline5m.map(k => parseFloat(k[4]));
                const rsi = calculateRSI(closes, 14);
                const fundingRate = parseFloat(funding.lastFundingRate) * 100;

                // --- ğŸ§  Ù…ØºØ² Ù…ØªÙÚ©Ø± (ÙÛŒÙ„ØªØ± Ø¯ÙˆØ¨Ù„) ---
                let signal = "WAIT";
                let cardClass = "";
                
                const trend1h = change1h > 0 ? 'UP' : 'DOWN';
                const trend15m = change15m > 0 ? 'UP' : 'DOWN';

                // Ø´Ø±Ø· Ø·Ù„Ø§ÛŒÛŒ: Ù‡Ø± Ø¯Ùˆ ØªØ§ÛŒÙ… ÙØ±ÛŒÙ… Ø¨Ø§ÛŒØ¯ Ù‡Ù…â€ŒØ¬Ù‡Øª Ø¨Ø§Ø´Ù†
                
                // Ø­Ø§Ù„Øª Ø®Ø±ÛŒØ¯ (LONG)
                if (trend1h === 'UP' && trend15m === 'UP') {
                    if (rsi < 40) { // Ø§ØµÙ„Ø§Ø­ Ø¯Ø± Ø±ÙˆÙ†Ø¯ ØµØ¹ÙˆØ¯ÛŒ Ù‚ÙˆÛŒ
                        signal = "ğŸš€ STRONG BUY";
                        cardClass = "active long";
                        if(rsi < 30) playSound();
                    }
                } 
                // Ø­Ø§Ù„Øª ÙØ±ÙˆØ´ (SHORT)
                else if (trend1h === 'DOWN' && trend15m === 'DOWN') {
                    if (rsi > 60) { // Ø§ØµÙ„Ø§Ø­ Ø¯Ø± Ø±ÙˆÙ†Ø¯ Ù†Ø²ÙˆÙ„ÛŒ Ù‚ÙˆÛŒ
                        signal = "ğŸ”» STRONG SELL";
                        cardClass = "active short";
                        if(rsi > 70) playSound();
                    }
                }
                // Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ (Ø®Ø·Ø±Ù†Ø§Ú© - Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù†Ø¯Ù‡)
                else {
                    signal = "CHOPPY (MIXED)";
                }

                updateCard(symbol, currentPrice, change1h, change15m, rsi, signal, cardClass, trend1h, trend15m);

            } catch (e) {}
        }

        function updateCard(symbol, price, ch1h, ch15m, rsi, signal, cardClass, t1h, t15m) {
            let card = document.getElementById(symbol);
            if (!card) {
                card = document.createElement('div');
                card.id = symbol;
                grid.appendChild(card);
            }

            card.className = `card ${cardClass}`;
            
            // Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø¬â€ŒÙ‡Ø§
            const c1h = t1h === 'UP' ? 'up' : 'down';
            const c15m = t15m === 'UP' ? 'up' : 'down';

            card.innerHTML = `
                <div class="card-header">
                    <span>${symbol.replace('USDT','')}</span>
                    <span style="color:${ch1h>=0?'#0f0':'#f00'}">${ch1h.toFixed(2)}%</span>
                </div>
                
                <div class="trend-row">
                    <span class="badge ${c1h}">1H: ${t1h}</span>
                    <span class="badge ${c15m}">15m: ${t15m}</span>
                </div>

                <div class="data-row">
                    <span>RSI (5m):</span> <span class="val" style="color:${rsi>70?'red':(rsi<30?'lime':'#888')}">${rsi.toFixed(1)}</span>
                </div>
                
                <div class="signal-box">${signal}</div>
            `;
            
            card.style.order = cardClass.includes('active') ? "-1" : "0";
        }

        function calculateRSI(prices, period) {
            let gains = 0, losses = 0;
            for (let i = prices.length - period; i < prices.length; i++) {
                const diff = prices[i] - prices[i - 1];
                if (diff >= 0) gains += diff;
                else losses -= diff;
            }
            const rs = gains / losses;
            return 100 - (100 / (1 + rs));
        }

        function playSound() { if(soundEnabled) document.getElementById('alertSound').play().catch(()=>{}); }
        function toggleSound() { soundEnabled = !soundEnabled; alert("Sound: " + soundEnabled); }

        init();
    </script>
</body>
</html>
