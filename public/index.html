<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHALE RADAR | SPOT HUNTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0b0e11; color: #e1e1e1; font-family: 'Rajdhani', sans-serif; margin: 0; padding: 20px; }
        
        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #2b3139; padding-bottom: 15px; margin-bottom: 20px; position: sticky; top: 0; background: #0b0e11; z-index: 100; }
        .logo { font-size: 28px; color: #f0b90b; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; }
        .stats { font-size: 14px; color: #848e9c; }

        /* TABLE */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { text-align: left; padding: 12px; color: #848e9c; border-bottom: 1px solid #2b3139; font-size: 14px; cursor: pointer; }
        td { padding: 12px; border-bottom: 1px solid #2b3139; font-size: 16px; font-weight: bold; }
        
        /* ROWS & COLORS */
        tr:hover { background-color: #1e2329; }
        .coin-name { display: flex; align-items: center; gap: 10px; }
        .coin-icon { width: 24px; height: 24px; border-radius: 50%; background: #333; }
        
        .score-box { padding: 5px 10px; border-radius: 4px; color: #000; font-weight: bold; text-align: center; width: 50px; display: inline-block; }
        
        .bullish { color: #0ecb81; }
        .bearish { color: #f6465d; }
        
        /* WHALE ALERT */
        .whale-alert { background: rgba(14, 203, 129, 0.2); border: 1px solid #0ecb81; color: #0ecb81; padding: 2px 6px; font-size: 10px; border-radius: 3px; margin-left: 5px; animation: pulse 1s infinite; }

        /* LOADING */
        #loader { text-align: center; margin-top: 50px; color: #f0b90b; font-size: 20px; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <div class="logo">ğŸ‹ WHALE RADAR <span style="font-size:12px; color:#fff; background:#2b3139; padding:2px 5px; border-radius:3px;">4H SPOT</span></div>
            <div class="stats">Scanning <span id="totalCoins">0</span> Assets | Seeking Trend & Volume</div>
        </div>
        <button onclick="fetchData()" style="background:#f0b90b; border:none; padding:10px 20px; font-weight:bold; cursor:pointer; border-radius:4px;">REFRESH SCAN</button>
    </div>

    <div id="loader">INITIALIZING SATELLITE CONNECTION... PLEASE WAIT...</div>

    <div class="table-container">
        <table id="dataTable" style="display:none;">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">ASSET</th>
                    <th onclick="sortTable(1)">PRICE</th>
                    <th onclick="sortTable(2)">24h CHG</th>
                    <th onclick="sortTable(3)">SCORE (0-100)</th>
                    <th onclick="sortTable(4)">STATUS</th>
                    <th>SIGNALS</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Rows injected here -->
            </tbody>
        </table>
    </div>

    <script>
        // Ù„ÛŒØ³Øª Ø§Ø±Ø²Ù‡Ø§ÛŒ Ù…Ù‡Ù… + Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù‡Ø§ÛŒ ØªÙˆ
        // (PNUT Ùˆ ACT Ø§Ú¯Ø± Ø¯Ø± Ø¨Ø§ÛŒÙ†Ù†Ø³ Ù†Ø¨Ø§Ø´Ù†Ø¯ Ø¯ÛŒØªØ§ Ù†Ù…ÛŒØ§Ø¯ØŒ ÙˆÙ„ÛŒ Ù…Ù† Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù…)
        const assets = [
            'BTC', 'ETH', 'BNB', 'SOL', 'XRP', 'ADA', 'AVAX', 'DOGE', 'SHIB', 'DOT',
            'LTC', 'LINK', 'MATIC', 'UNI', 'ATOM', 'ETC', 'XLM', 'FIL', 'NEAR', 'ALGO',
            'APE', 'SAND', 'MANA', 'AXS', 'THETA', 'EOS', 'AAVE', 'FTM', 'GRT', 'KLAY',
            'NEO', 'MKR', 'SNX', 'RUNE', 'CAKE', 'CHZ', 'COMP', 'BAT', 'ZEC', 'ENJ',
            'DASH', 'STX', 'MINA', 'CRV', 'IOTA', 'XMR', 'LDO', 'QNT', 'AR', 'GMT',
            'KAVA', 'TWT', 'ONE', 'ZIL', 'GALA', 'CELO', 'FLOW', 'KSM', 'CVX', 'DYDX',
            '1INCH', 'HOT', 'COMP', 'YFI', 'BAL', 'SUSHI', 'RSR', 'IOST', 'OMG', 'ANKR',
            'ACT', 'PNUT', 'PEPE', 'FLOKI', 'BONK', 'WIF', 'RENDER', 'FET', 'AGIX', 'OCEAN',
            'ARB', 'OP', 'SUI', 'SEI', 'TIA', 'APT', 'INJ', 'IMX', 'LUNC', 'CFX'
        ];

        document.getElementById('totalCoins').innerText = assets.length;
        const tbody = document.getElementById('tableBody');
        const loader = document.getElementById('loader');
        const table = document.getElementById('dataTable');

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø¯ÛŒØªØ§
        async function fetchData() {
            loader.style.display = 'block';
            table.style.display = 'none';
            tbody.innerHTML = '';
            
            let processed = 0;
            let results = [];

            // Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø§Ø±Ø² Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ 4 Ø³Ø§Ø¹ØªÙ‡ Ø±Ùˆ Ø¨Ú¯ÛŒØ±ÛŒÙ…
            // Ø¨Ø±Ø§ÛŒ Ø³Ø±Ø¹ØªØŒ Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ùˆ Ù…ÙˆØ§Ø²ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒØ¯ÛŒÙ… ÙˆÙ„ÛŒ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ú©Ù‡ Ø¨Ù† Ù†Ø´ÛŒÙ…
            const batchSize = 5; 
            
            for (let i = 0; i < assets.length; i += batchSize) {
                const batch = assets.slice(i, i + batchSize);
                const promises = batch.map(symbol => analyzeCoin(symbol));
                const batchResults = await Promise.all(promises);
                results = [...results, ...batchResults.filter(r => r !== null)];
                
                processed += batch.length;
                loader.innerText = `SCANNING MARKETS... ${Math.round((processed / assets.length) * 100)}%`;
            }

            // Ù…Ø±ØªØ¨ Ø³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù…ØªÛŒØ§Ø² (Ù‚ÙˆÛŒ ØªØ±ÛŒÙ† Ù‡Ø§ Ø§ÙˆÙ„)
            results.sort((a, b) => b.score - a.score);

            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¬Ø¯ÙˆÙ„
            results.forEach(coin => {
                const row = document.createElement('tr');
                
                // Ø±Ù†Ú¯ Ø§Ù…ØªÛŒØ§Ø²
                let scoreColor = '#848e9c'; // Ø®Ø§Ú©Ø³ØªØ±ÛŒ
                let bgScore = '#2b3139';
                if(coin.score >= 80) { scoreColor = '#000'; bgScore = '#0ecb81'; } // Ø³Ø¨Ø² Ù‚ÙˆÛŒ
                else if(coin.score >= 60) { scoreColor = '#0ecb81'; bgScore = 'rgba(14, 203, 129, 0.1)'; } // Ø³Ø¨Ø²
                else if(coin.score <= 20) { scoreColor = '#000'; bgScore = '#f6465d'; } // Ù‚Ø±Ù…Ø² Ù‚ÙˆÛŒ
                else if(coin.score <= 40) { scoreColor = '#f6465d'; bgScore = 'rgba(246, 70, 93, 0.1)'; } // Ù‚Ø±Ù…Ø²

                // Whale Alert
                let whaleBadge = coin.whale ? '<span class="whale-alert">WHALE DETECTED</span>' : '';

                row.innerHTML = `
                    <td>
                        <div class="coin-name">
                            <img src="https://assets.coincap.io/assets/icons/${coin.symbol.toLowerCase()}@2x.png" class="coin-icon" onerror="this.style.display='none'">
                            ${coin.symbol} <span style="font-size:10px; color:#666;">USDT</span>
                        </div>
                    </td>
                    <td>$${parseFloat(coin.price).toFixed(coin.price < 1 ? 4 : 2)}</td>
                    <td class="${coin.change >= 0 ? 'bullish' : 'bearish'}">${coin.change}%</td>
                    <td><div class="score-box" style="background:${bgScore}; color:${scoreColor}">${coin.score}</div></td>
                    <td style="color:${scoreColor}">${coin.status}</td>
                    <td>${whaleBadge}</td>
                `;
                tbody.appendChild(row);
            });

            loader.style.display = 'none';
            table.style.display = 'table';
        }

        // ØªØ­Ù„ÛŒÙ„ Ù‡Ø± Ø§Ø±Ø²
        async function analyzeCoin(symbol) {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Û±Û°Û° Ú©Ù†Ø¯Ù„ Û´ Ø³Ø§Ø¹ØªÙ‡
                const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}USDT&interval=4h&limit=100`);
                const data = await res.json();
                
                if(data.code) return null; // Ø§Ú¯Ø± Ø§Ø±Ø² Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯

                // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù†Ø¯Ù„ Ù‡Ø§
                const closes = data.map(d => parseFloat(d[4]));
                const volumes = data.map(d => parseFloat(d[5]));
                const currentPrice = closes[closes.length - 1];
                const prevPrice = closes[closes.length - 2]; // Ù‚ÛŒÙ…Øª Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡ Ú©Ù†Ø¯Ù„ Ù‚Ø¨Ù„ÛŒ (Ø¨Ø±Ø§ÛŒ Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±)
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ± Û²Û´ Ø³Ø§Ø¹ØªÙ‡ (ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø¨Ø§ Û¶ Ú©Ù†Ø¯Ù„ Û´ Ø³Ø§Ø¹ØªÙ‡)
                const open24h = parseFloat(data[data.length - 6][1]); 
                const change24h = ((currentPrice - open24h) / open24h) * 100;

                // --- Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ±Ù‡Ø§ ---
                const rsi = calculateRSI(closes, 14);
                const ema50 = calculateEMA(closes, 50);
                const avgVol = calculateSMA(volumes, 20); // Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø­Ø¬Ù… Û²Û° Ú©Ù†Ø¯Ù„ Ø§Ø®ÛŒØ±
                const currentVol = volumes[volumes.length - 1];

                // --- Ø³ÛŒØ³ØªÙ… Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ (0 ØªØ§ 100) ---
                let score = 50;
                let status = "NEUTRAL";

                // 1. Ø±ÙˆÙ†Ø¯ (Trend) - 30 Ø§Ù…ØªÛŒØ§Ø²
                if (currentPrice > ema50) {
                    score += 20; // Ø¨Ø§Ù„Ø§ÛŒ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† (ØµØ¹ÙˆØ¯ÛŒ)
                    // Ø§Ú¯Ø± Ú©Ù†Ø¯Ù„ Ù‚Ø¨Ù„ÛŒ Ù‡Ù… ØµØ¹ÙˆØ¯ÛŒ Ø¨ÙˆØ¯
                    if (currentPrice > prevPrice) score += 10;
                } else {
                    score -= 20; // Ø±ÙˆÙ†Ø¯ Ù†Ø²ÙˆÙ„ÛŒ
                }

                // 2. Ù…ÙˆÙ…Ù†ØªÙˆÙ… (RSI) - 30 Ø§Ù…ØªÛŒØ§Ø²
                if (rsi > 50 && rsi < 70) score += 15; // Ù…Ù†Ø·Ù‚Ù‡ Ø§Ù…Ù† ØµØ¹ÙˆØ¯
                if (rsi >= 70) score -= 10; // Ø§Ø´Ø¨Ø§Ø¹ Ø®Ø±ÛŒØ¯ (Ø®Ø·Ø± Ø§ØµÙ„Ø§Ø­)
                if (rsi < 30) score += 10; // Ø§Ø´Ø¨Ø§Ø¹ ÙØ±ÙˆØ´ (Ø´Ø§Ù†Ø³ Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø§Ù„Ø§)
                if (rsi > 30 && rsi < 50) score -= 10; // Ù…Ù†Ø·Ù‚Ù‡ Ø¶Ø¹Ù

                // 3. Ø­Ø¬Ù… (Volume) - 20 Ø§Ù…ØªÛŒØ§Ø² (Ù†Ù‡Ù†Ú¯ ÛŒØ§Ø¨)
                let isWhale = false;
                if (currentVol > avgVol * 2) {
                    score += 20; // Ø­Ø¬Ù… Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†!
                    isWhale = true;
                } else if (currentVol > avgVol) {
                    score += 10;
                }

                // ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ù…ØªÙ†ÛŒ
                if(score >= 80) status = "STRONG BUY ğŸš€";
                else if(score >= 60) status = "BUY";
                else if(score <= 20) status = "STRONG SELL ğŸ©¸";
                else if(score <= 40) status = "SELL";

                // Ù†Ø±Ù…Ø§Ù„ Ø³Ø§Ø²ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø¨ÛŒÙ† 0 ØªØ§ 100
                if(score > 100) score = 100;
                if(score < 0) score = 0;

                return {
                    symbol,
                    price: currentPrice,
                    change: change24h.toFixed(2),
                    score,
                    status,
                    whale: isWhale
                };

            } catch (e) {
                return null;
            }
        }

        // --- ØªÙˆØ§Ø¨Ø¹ Ø±ÛŒØ§Ø¶ÛŒ ---
        function calculateRSI(prices, period) {
            let gains = 0, losses = 0;
            for (let i = prices.length - period; i < prices.length; i++) {
                const diff = prices[i] - prices[i - 1];
                if (diff >= 0) gains += diff;
                else losses -= diff;
            }
            const rs = gains / losses;
            return 100 - (100 / (1 + rs));
        }

        function calculateEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = (prices[i] * k) + (ema * (1 - k));
            }
            return ema;
        }

        function calculateSMA(data, period) {
            if(data.length < period) return 0;
            const slice = data.slice(data.length - period);
            const sum = slice.reduce((a, b) => a + b, 0);
            return sum / period;
        }

        // Ø´Ø±ÙˆØ¹ Ø®ÙˆØ¯Ú©Ø§Ø±
        fetchData();
        // Ø±ÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ (Ú†ÙˆÙ† ØªØ§ÛŒÙ… ÙØ±ÛŒÙ… Û´ Ø³Ø§Ø¹ØªÙ‡ Ø§Ø³ØªØŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±ÙØ±Ø´ Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ Ù†ÛŒØ³Øª)
        setInterval(fetchData, 300000); 

    </script>
</body>
</html>
